<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Productos compuestos - Toro Rápido</title>
    <link rel="icon" href="../../../imagenes/logos/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Bungee&family=Inter:wght@400;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../admin-header.css">
    <link rel="stylesheet" href="../admin-menu-compuesto/admin-menu-compuesto.css">
    <link rel="stylesheet" href="admin-productos-compuestos.css">
</head>
<body>
    <div id="admin-header-slot"></div>
    <main class="admin-menu">
        <header class="admin-header">
            <p>Gestión de productos compuestos (ítems guardados en <strong>productos-compuesto-detalle</strong>).</p>
        </header>

        <section class="admin-card">
            <div class="card-title">
                <i class="fa-solid fa-layer-group"></i> Productos compuestos
            </div>
            <p class="field-hint">Desde acá podés agregar ítems al producto compuesto (se guardan en la hoja productos-compuesto-detalle) o gestionar el menú compuesto.</p>

            <div id="ultima-insercion-wrap" class="ultima-insercion-wrap" style="display: none;" role="status" aria-live="polite">
                <h3 class="ultima-insercion-title"><i class="fa-solid fa-circle-check" aria-hidden="true"></i> Última inserción</h3>
                <p id="ultima-insercion-resumen" class="ultima-insercion-resumen"></p>
                <div id="ultima-insercion-tabla-wrap" class="table-wrap" style="display: none;">
                    <table class="menu-table ultima-insercion-table" aria-label="Detalle de la última inserción">
                        <thead>
                            <tr>
                                <th>idproducto-base</th>
                                <th>Cantidad</th>
                                <th>Producto</th>
                                <th>Precio Unitario Actual</th>
                                <th>Precio Total Actual</th>
                            </tr>
                        </thead>
                        <tbody id="ultima-insercion-tbody"></tbody>
                        <tfoot id="ultima-insercion-tfoot" class="ultima-insercion-tfoot" style="display: none;">
                            <tr>
                                <td colspan="4" class="ultima-insercion-total-label">Total</td>
                                <td id="ultima-insercion-total-precio" class="ultima-insercion-total-valor">—</td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>

            <section id="form-productos-compuesto-wrap" class="admin-card form-productos-compuesto-wrap" style="display: none;">
                <div class="card-title"><i class="fa-solid fa-pen-to-square" aria-hidden="true"></i> Datos del producto compuesto (hoja productos-compuesto)</div>
                <p class="field-hint">Completá los datos del producto compuesto y guardalos en la hoja <strong>productos-compuesto</strong>. El <strong>idproducto</strong> es el mismo que el detalle (PROD-COMPUESTO-xxx).</p>
                <div class="form-productos-compuesto-inner">
                    <input type="hidden" id="pc-orden">
                    <input type="hidden" id="pc-idproducto">
                    <div class="form-row form-row-informativo">
                        <span class="form-label-informativo">Orden</span>
                        <span id="pc-orden-value" class="form-value-informativo" aria-live="polite">—</span>
                    </div>
                    <div class="form-row form-row-informativo">
                        <span class="form-label-informativo">idproducto</span>
                        <span id="pc-idproducto-value" class="form-value-informativo" aria-live="polite">—</span>
                    </div>
                    <p class="field-hint-inline" style="margin-top: -0.5rem; margin-bottom: 1rem;">Estos valores se asignan automáticamente (no se cargan manualmente).</p>
                    <div class="form-row">
                        <label for="pc-categoria">Categoria</label>
                        <input type="text" id="pc-categoria" list="pc-categoria-datalist" placeholder="Elegí uno o escribí uno nuevo" autocomplete="off" aria-describedby="pc-categoria-hint">
                        <datalist id="pc-categoria-datalist"></datalist>
                        <span id="pc-categoria-hint" class="field-hint-inline">Valores de la hoja productos-compuesto. Elegí uno o escribí uno nuevo.</span>
                    </div>
                    <div class="form-row">
                        <label for="pc-producto">Producto</label>
                        <input type="text" id="pc-producto" placeholder="Nombre del producto compuesto">
                    </div>
                    <div class="form-row">
                        <label for="pc-descripcion">Descripcion</label>
                        <textarea id="pc-descripcion" rows="2" placeholder="Descripción opcional"></textarea>
                    </div>
                    <div class="form-row">
                        <label for="pc-precio-actual">Precio Actual</label>
                        <input type="text" id="pc-precio-actual" placeholder="Ej. 0 o dejar vacío">
                    </div>
                    <div class="form-row form-row-informativo">
                        <span class="form-label-informativo">Precio Regular</span>
                        <span id="pc-precio-regular-value" class="form-value-informativo" aria-live="polite">—</span>
                        <input type="hidden" id="pc-precio-regular">
                    </div>
                    <p class="field-hint-inline" style="margin-top: -0.5rem; margin-bottom: 0.5rem;">Total del resumen (Precio Total Actual de los ítems). No editable.</p>
                    <div class="form-row">
                        <label for="pc-mostar-monto-descuento">Mostar Monto Descuento</label>
                        <select id="pc-mostar-monto-descuento">
                            <option value="NO" selected>NO</option>
                            <option value="SI">SI</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <label for="pc-mostar-descuento">Mostar Descuento</label>
                        <select id="pc-mostar-descuento">
                            <option value="NO">NO</option>
                            <option value="SI" selected>SI</option>
                        </select>
                    </div>
                    <div class="form-row form-row-imagen">
                        <label for="pc-imagen-file">Imagen</label>
                        <input type="hidden" id="pc-imagen">
                        <div class="imagen-controls">
                            <label class="imagen-file-btn">
                                <input type="file" id="pc-imagen-file" accept="image/*" aria-label="Elegir imagen" class="imagen-file-input">
                                <i class="fa-solid fa-image" aria-hidden="true"></i>
                                <span>Elegir imagen</span>
                            </label>
                            <input type="text" id="pc-imagen-url" placeholder="O pegá una URL de imagen" autocomplete="off">
                        </div>
                        <div id="pc-imagen-preview-wrap" class="imagen-preview-wrap" aria-live="polite">
                            <img id="pc-imagen-preview" class="imagen-preview" src="" alt="Vista previa" style="display: none;">
                            <span id="pc-imagen-preview-placeholder" class="imagen-preview-placeholder">Sin imagen</span>
                        </div>
                    </div>
                    <div class="form-row form-row-inline">
                        <label><input type="checkbox" id="pc-es-destacado" value="SI"> <i class="fa-solid fa-crown icon-crown-gold" aria-hidden="true"></i> Es Destacado</label>
                    </div>
                    <div class="form-row form-row-inline" style="display: none;" aria-hidden="true">
                        <label><input type="checkbox" id="pc-producto-agotado" value="SI"> Producto Agotado</label>
                    </div>
                    <div class="form-row" style="display: none;" aria-hidden="true">
                        <label for="pc-stock">STOCK</label>
                        <input type="text" id="pc-stock" value="99">
                    </div>
                    <div class="form-row form-row-inline">
                        <label><input type="checkbox" id="pc-habilitado" value="SI" checked> Habilitado</label>
                    </div>
                    <div class="form-actions form-actions-end" style="margin-top: 1rem;">
                        <button type="button" id="btn-guardar-productos-compuesto" class="primary-btn"><i class="fa-solid fa-save" aria-hidden="true"></i> Guardar en productos-compuesto</button>
                    </div>
                </div>
                <div class="script-debug" id="script-debug-compuesto" aria-live="polite"></div>
            </section>

            <div id="debug-payload-wrap" class="debug-payload-wrap" aria-live="polite"></div>

            <div class="form-actions form-actions-end" style="margin-top: 1rem;">
                <a href="../admin-productos-compuestos-detalle/admin-productos-compuestos-detalle.html" class="primary-btn"><i class="fa-solid fa-circle-plus" aria-hidden="true"></i> Agregar ítem al producto compuesto</a>
                <a href="../admin-menu-compuesto/admin-menu-compuesto.html" class="secondary-btn"><i class="fa-solid fa-list" aria-hidden="true"></i> Ver menú compuesto</a>
            </div>
        </section>
    </main>

    <footer class="admin-footer">
        <div class="footer-container">
            <h2 class="footer-title">Toro Rápido</h2>
            <div class="footer-meta">San Miguel de Tucumán.</div>
            <div class="footer-meta">© <span data-admin-year></span> Todos los derechos reservados.</div>
        </div>
    </footer>

    <script src="../../Configuracion/config.js" defer></script>
    <script src="../admin-common.js" defer></script>
    <script src="admin-productos-compuestos.js" defer></script>
</body>
</html>
